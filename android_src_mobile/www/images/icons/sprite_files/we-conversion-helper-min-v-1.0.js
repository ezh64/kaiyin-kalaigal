(function(b){var c=b.util;if(_weq["webengage.licenseCode"]){var a=(location.host.match(/[-\w]+(\.(?:[-\w]+\.xn--[-\w]+|[-\w]{3,}|[-\w]+\.[-\w]{2}))?$/i))[0];if(location.host.match(/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/)){a=location.host}var e=null,d={setGoalsCookie:function(g){var f=g||{};var h=c.stringify(f);if(h){c.setCookie("_we_wk_gls_ss_",b.LZString.compressToBase64(h),"","/","."+a,"",true)}return f},getGoalsCookie:function(){var f=null,h=c.getCookie("_we_wk_gls_ss_",true);if(h){try{if(h.charAt(0)!=="{"){h=b.LZString.decompressFromBase64(h)}f=(new Function("return "+h)())}catch(g){}}return f},findNonHashedIds:function(k,j){var g=[];if(k&&k[j]&&c.isArray(k[j])&&k[j].length>0){for(var h=0,f=k[j].length;h<f;h++){if(k[j][h]&&k[j][h].indexOf("#")<0){g.push(k[j][h]);k[j][h]=k[j][h]+"#"}}}return g},getActiveIds:function(n,j){var g=[],m=c.getServerTimeStamp()||null;if(n){for(var k=0,h=n.length;k<h;k++){var o=n[k]["startTimestamp"],f=n[k]["endTimestamp"];if(m&&((f&&f<m)||(o&&m<o))){continue}g.push(n[k][j])}}return g},getAllActiveNotifications:function(){return d.getActiveIds(e.notificationRuleList,"notificationEncId")},getAllActiveSurveys:function(){return d.getActiveIds(e.surveyRuleList,"surveyEncId")},idsToRetain:function(m,g){var h=[],k=g?g.join():"";if(m&&k){for(var j=0,f=m.length;j<f;j++){if(k.indexOf(m[j])>=0){h.push(m[j])}}return h}},logConversion:function(g,f){if(g){b.withELog(function(){var k=d.getGoalsCookie(),j={gId:g},r={},s;if(k&&k[g]){var o=d.getAllActiveNotifications(),l=d.getAllActiveSurveys();if(o.length>0){var i=d.idsToRetain(((c.isArray(k[g]["snids"])&&k[g]["snids"].length>0)?k[g]["snids"]:null),o),h=d.idsToRetain(((c.isArray(k[g]["cnids"])&&k[g]["cnids"].length>0)?k[g]["cnids"]:null),o),n=d.idsToRetain(((c.isArray(k[g]["canids"])&&k[g]["canids"].length>0)?k[g]["canids"]:null),o),p=d.idsToRetain(d.findNonHashedIds(k[g],"anids"),o);if(i&&i.length>0){r.snids=i}if(n&&n.length>0){r.ncnids=n}if(h&&h.length>0){r.cnids=h}if(p&&p.length>0){r.anids=p}}if(l.length>0){var t=d.idsToRetain(((c.isArray(k[g]["ssids"])&&k[g]["ssids"].length>0)?k[g]["ssids"]:null),l),q=d.idsToRetain(((c.isArray(k[g]["tsids"])&&k[g]["tsids"].length>0)?k[g]["tsids"]:null),l),m=d.idsToRetain(d.findNonHashedIds(k[g],"asids"),l);if(t&&t.length>0){r.ssids=t}if(q&&q.length>0){r.tsids=q}if(m&&m.length>0){r.asids=m}}}if((_weq["webengage.customData"]&&!b.util.isEmptyObject(_weq["webengage.customData"]))||(_weq["webengage.notification.customData"]&&!b.util.isEmptyObject(_weq["webengage.notification.customData"]))||(_weq["webengage.survey.customData"]&&!b.util.isEmptyObject(_weq["webengage.survey.customData"]))){c.copy(r,(_weq["webengage.customData"]||{}));c.copy(r,(_weq["webengage.survey.customData"]||{}),true);c.copy(r,(_weq["webengage.notification.customData"]||{}),true)}if(f&&!b.util.isEmptyObject(f)){c.copy(r,f,true)}b.dump("goal_accomplish",r,j);if(k&&k[g]){delete k[g]["snids"];delete k[g]["cnids"];delete k[g]["canids"];delete k[g]["ssids"];delete k[g]["tsids"];d.setGoalsCookie(k)}},null,true)}}};b.withELog(function(){c.extend("goals",(function(){var h=0;function g(j){var l=["open","click","dump"],m=j.id;for(var k=0;k<l.length;k++){b.notification.attachEventListner(l[k],(function(i){return function(q){var r=q.notificationId||q.id;if(r&&j.nIds.join().indexOf(r)>=0){var n=d.getGoalsCookie(),n=n||{};var p=b.util.getSessionCookie();n[m]=n[m]||{};switch(i){case"open":if(typeof q.isClickable==="boolean"&&q.isClickable){n[m]["canids"]=n[m]["canids"]||[];if(n[m]["canids"].join().indexOf(q.notificationId)<0){n[m]["canids"].push(q.notificationId)}}else{n[m]["snids"]=n[m]["snids"]||[];if(n[m]["snids"].join().indexOf(q.notificationId)<0){n[m]["snids"].push(q.notificationId)}}d.setGoalsCookie(n);break;case"click":n[m]["cnids"]=n[m]["cnids"]||[];if(n[m]["cnids"].join().indexOf(q.notificationId)<0){n[m]["cnids"].push(q.notificationId)}d.setGoalsCookie(n);break;case"dump":var s=arguments[1];if(s&&(s==="view"||s==="abs_view")){var o=(s==="view"?"intc":"aintc");if(!n[m][o]){q.goalIds=q.goalIds||[];q.goalIds.push(m);n[m][o]=1}if(s==="abs_view"){n[m]["anids"]=n[m]["anids"]||[];if(n[m]["anids"].indexOf(r)<0&&n[m]["anids"].indexOf(r+"#")<0){n[m]["anids"].push(r)}}d.setGoalsCookie(n)}break}}}})(l[k]))}}function f(j){var l=["open","submit","complete","dump"],m=j.id;for(var k=0;k<l.length;k++){b.survey.attachEventListner(l[k],(function(i){return function(q){var n=q.surveyId||q.id;if(n&&j.sIds.join().indexOf(n)>=0){var o=d.getGoalsCookie(),o=o||{};o[m]=o[m]||{};switch(i){case"open":o[m]["ssids"]=o[m]["ssids"]||[];if(o[m]["ssids"].join().indexOf(n)<0){o[m]["ssids"].push(n)}d.setGoalsCookie(o);break;case"submit":case"complete":o[m]["tsids"]=o[m]["tsids"]||[];if(o[m]["tsids"].join().indexOf(n)<0){o[m]["tsids"].push(n)}d.setGoalsCookie(o);if(j.type&&j.type==="SURVEY_COMPLETION"&&"complete"===i){d.logConversion(m)}break;case"dump":var r=arguments[1];if(r&&(r==="view"||r==="abs_view")){var p=(r==="view"?"intc":"aintc");if(!o[m][p]){q.goalIds=q.goalIds||[];q.goalIds.push(m);o[m][p]=1}if(r==="abs_view"){o[m]["asids"]=o[m]["asids"]||[];if(o[m]["asids"].indexOf(n)<0&&o[m]["asids"].indexOf(n+"#")<0){o[m]["asids"].push(n)}}d.setGoalsCookie(o)}break}}}})(l[k]))}}return{push:function(m,l){if(m&&e&&e.goals&&e.goals.length){for(var j=0;j<e.goals.length;j++){var k=e.goals[j];if(k.id&&k.id===m){d.logConversion(m,l)}}}},init:function(i){if(!h&&i&&c.isArray(i.goals)&&i.goals.length>0){e=i;h=1;c.onReady(function(){_weq["webengage.enableCallbacks"]=true;for(var m=0;m<e.goals.length;m++){var l=e.goals[m],o=l.value,n=l.type;if(!n||n==="WEB_RULE"){var k=_weq["webengage.ruleData"]||_weq["webengage.goals.ruleData"]||{};var j=b.ruleExecutor.execute("",o,k);if(j){d.logConversion(l.id)}}if(c.isArray(l.nIds)&&l.nIds.length>0){g(l,e)}if(c.isArray(l.sIds)&&l.sIds.length>0){f(l,e)}}})}}}})())},null,true)}})(webengage);